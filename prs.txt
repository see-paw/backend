- Feature/ Criar apadrinhamento (Fostering) #63 - basic`nDescri√ß√£o do Pull Request

Este pull request implementa o endpoint respons√°vel pela cria√ß√£o de apadrinhamentos de animais, permitindo que um utilizador autenticado se torne padrinho de um animal com um valor mensal definido.
A opera√ß√£o est√° totalmente integrada com o dom√≠nio e respeita as regras de neg√≥cio estabelecidas para o processo de apadrinhamento (RFFOS-01).

Principais altera√ß√µes

Adicionado handler AddFostering (Application.Fosterings.Commands.AddFostering) com l√≥gica de cria√ß√£o de apadrinhamentos, valida√ß√£o de estado e transa√ß√£o at√≥mica.

Criado servi√ßo de dom√≠nio FosteringDomainService para c√°lculos de apoio atual e verifica√ß√£o de apadrinhamentos ativos por utilizador.

Implementado servi√ßo de aplica√ß√£o FosteringService para atualiza√ß√£o de estado do animal (Available, PartiallyFostered, TotallyFostered) e controlo de limites de custo.

Adicionados validadores FluentValidation:

AddFosteringValidator ‚Äî valida formato do AnimalId e m√≠nimo configurado de valor mensal.

ReqAddFosteringDtoValidator ‚Äî valida dados do corpo do pedido (valor > 0 e n√£o nulo).

Atualizado o controller AnimalsController com o endpoint:

Closes - #63 
- feat: Consultar Ownerships Ativos #35`n<h2>üß© Overview</h2>
<p>Implementa√ß√£o da <b>consulta de Ownerships ativos</b> de um utilizador, incluindo a listagem dos animais atualmente adotados e o hist√≥rico recente de pedidos de ado√ß√£o.<br>
Al√©m disso, foi ajustada a verifica√ß√£o de elegibilidade de animais para permitir ado√ß√µes mesmo quando o animal tem padrinhos ativos.</p>

<hr>

<h2>üì¶ Queries</h2>

<h3><b>GetUserOwnedAnimals ‚Äì Listar Ownerships Ativos</b></h3>
<ul>
  <li>Retorna todos os animais atualmente <b>adotados (HasOwner)</b> pelo utilizador autenticado.</li>
  <li>Ordena por <code>OwnershipStartDate</code> decrescente (animais mais recentes primeiro).</li>
  <li>Garante que apenas animais com <code>OwnerId</code> igual ao utilizador autenticado s√£o retornados.</li>
</ul>

<p><b>Valida√ß√µes principais:</b></p>
<table>
<thead><tr><th>Verifica√ß√£o</th><th>C√≥digo</th><th>Mensagem</th></tr></thead>
<tbody>
<tr><td>Utilizador autenticado existente</td><td>404</td><td>"User not found"</td></tr>
<tr><td>Lista vazia quando n√£o h√° animais</td><td>200</td><td><code>[]</code></td></tr>
</tr>
</tbody>
</table>

<hr>

<h3><b>GetOwnershipRequestsByUser ‚Äì Listar Pedidos de Ado√ß√£o do Utilizador</b></h3>
<ul>
  <li>Retorna pedidos de ownership submetidos pelo utilizador autenticado.</li>
  <li>Inclui pedidos <b>ativos</b> (pendentes, em an√°lise, aprovados) e <b>rejeitados no √∫ltimo m√™s</b>.</li>
  <li>Ordena pedidos <b>n√£o rejeitados primeiro</b> e, dentro do mesmo estado, por <code>RequestedAt</code> decrescente.</li>
</ul>

<p><b>Regras de inclus√£o:</b></p>
<ul>
  <li>Exclui pedidos rejeitados h√° mais de 30 dias.</li>
  <li>Inclui rejeitados recentes (‚â§ 1 m√™s).</li>
  <li>Mostra dados resumidos do animal, estado do pedido e data.</li>
</ul>

<hr>

<h3><b>CheckAnimalEligibilityForOwnership ‚Äì Atualiza√ß√£o</b></h3>
<ul>
  <li>Atualizada a l√≥gica para permitir ado√ß√µes de animais com <b>padrinhos ativos</b>, desde que o animal n√£o tenha dono (<code>AnimalState.HasOwner</code>) e n√£o esteja inativo.</li>
  <li>Continua a validar a exist√™ncia do animal e o seu estado.</li>
</ul>

<p><b>Novas condi√ß√µes:</b></p>
<table>
<thead><tr><th>Condi√ß√£o</th><th>Resultado</th></tr></thead>
<tbody>
<tr><td>Animal com padrinhos mas sem dono</td><td>‚úÖ Eleg√≠vel para ado√ß√£o</td></tr>
<tr><td>Animal com dono (<code>HasOwner</code>) ou inativo</td><td>‚ùå N√£o eleg√≠vel</td></tr>
<tr><td>Animal inexistente</td><td>‚ùå 404 ‚Äì "Animal ID not found"</td></tr>
</tbody>
</table>

<hr>

<h2>üîó API Endpoints</h2>
<p>Base URL: <code>/api/ownerships</code></p>

<table>
<thead><tr><th>M√©todo</th><th>Endpoint</th><th>Descri√ß√£o</th><th>Autentica√ß√£o</th></tr></thead>
<tbody>
<tr><td>GET</td><td><code>/requests</code></td><td>Lista pedidos de ado√ß√£o do utilizador</td><td><code>User</code> autenticado</td></tr>
<tr><td>GET</td><td><code>/owned-animals</code></td><td>Lista animais atualmente adotados (ownerships ativos)</td><td><code>User</code> autenticado</td></tr>
</tbody>
</table>

<hr>

<h2>üì§ Request & Response</h2>

<h3><b>GET /api/ownerships/owned-animals</b></h3>
<p><b>Response (200):</b></p>
<pre><code class="language-json">[
  {
    "id": "animal-123",
    "animalId": "animal-123",
    "animalName": "Max",
    "animalState": "HasOwner",
    "amount": 50,
    "image": {
      "url": "https://res.cloudinary.com/.../max.jpg",
      "isPrincipal": true
    },
    "requestedAt": "2025-07-01T12:00:00Z",
    "approvedAt": "2025-07-03T12:00:00Z"
  }
]
</code></pre>

<h3><b>GET /api/ownerships/requests</b></h3>
<p><b>Response (200):</b></p>
<pre><code class="language-json">[
  {
    "id": "req-456",
    "animalId": "animal-123",
    "animalName": "Max",
    "ownershipStatus": "Pending",
    "requestedAt": "2025-10-10T10:00:00Z",
    "updatedAt": "2025-10-15T12:00:00Z",
    "image": {
      "url": "https://res.cloudinary.com/.../max.jpg",
      "isPrincipal": true
    }
  }
]
</code></pre>

<hr>

<h2>üß™ Testes Unit√°rios</h2>
<p>Foram adicionados e atualizados testes nas seguintes classes:</p>
<table>
<thead><tr><th>Ficheiro</th><th>Descri√ß√£o</th></tr></thead>
<tbody>
<tr><td><code>GetUserOwnedAnimalsTests.cs</code></td><td>Testes de consulta de animais adotados ‚Äî cen√°rios de sucesso, ordena√ß√£o, inclus√£o de entidades e cancelamento.</td></tr>
<tr><td><code>GetOwnershipRequestsByUserTests.cs</code></td><td>Testes de filtragem, ordena√ß√£o e tempo de rejei√ß√£o (1 m√™s) em pedidos de ownership.</td></tr>
<tr><td><code>OwnershipControllerTests.cs</code></td><td>Testes de integra√ß√£o e mapeamento para os endpoints <code>/requests</code> e <code>/owned-animals</code>.</td></tr>
</tbody>
</table>

<p><b>Cobertura validada:</b></p>
<ul>
  <li>7 cen√°rios no <code>GetUserOwnedAnimalsTests</code></li>
  <li>15+ cen√°rios no <code>GetOwnershipRequestsByUserTests</code></li>
  <li>Controlador testado isoladamente com mocks de <code>Mediator</code> e <code>Mapper</code></li>
</ul>

<hr>

<h2>‚úÖ Regras e Valida√ß√µes</h2>
<table>
<thead><tr><th>Verifica√ß√£o</th><th>C√≥digo</th><th>Mensagem</th></tr></thead>
<tbody>
<tr><td>Utilizador n√£o autenticado</td><td>401</td><td>"Unauthorized"</td></tr>
<tr><td>Utilizador inexistente</td><td>404</td><td>"User not found"</td></tr>
<tr><td>Pedido inexistente</td><td>404</td><td>"No ownership requests found"</td></tr>
<tr><td>Animal com dono/inativo</td><td>400</td><td>"Animal not eligible for ownership"</td></tr>
<tr><td>Consulta bem-sucedida</td><td>200</td><td>Lista de ownerships ou lista vazia</td></tr>
</tbody>
</table>

<hr>

<h2>üìö Documenta√ß√£o e Testes</h2>
<ul>
  <li>Documenta√ß√£o XML e coment√°rios <code>///</code> adicionados a todas as classes e m√©todos p√∫blicos.</li>
  <li>DTO <code>ResUserOwnershipsDto</code> atualizado para incluir campos <code>RequestInfo</code>, <code>ApprovedAt</code>, <code>UpdatedAt</code>.</li>
  <li>Todos os testes passaram com sucesso no pipeline CI.</li>
</ul>

<hr>

<h3>üîí Autoriza√ß√£o</h3>
<table>
<thead><tr><th>A√ß√£o</th><th>Papel Necess√°rio</th></tr></thead>
<tbody>
<tr><td>Consultar pedidos de ownership</td><td><code>User</code></td></tr>
<tr><td>Consultar animais adotados</td><td><code>User</code></td></tr>
</tbody>
</table>

<hr>

<p><b>Closes issue #35</b><br>
Implementa o requisito <b>RFOWN-10 ‚Äì Consultar lista de Ownerships ativos</b><br>
e atualiza a elegibilidade de animais para ado√ß√£o.</p>

- feat: verify eligibility ownership request (#23)- basic`n### üß© Feature: Verifica√ß√£o de Elegibilidade de Animal para Ownership

**üîπ Descri√ß√£o geral**
Foi implementada uma verifica√ß√£o centralizada de elegibilidade de animais para pedidos de Ownership, garantindo que apenas animais com estado dispon√≠vel possam ser associados a novos pedidos.
A l√≥gica foi reorganizada para maior coer√™ncia arquitet√≥nica:
A query de valida√ß√£o pertence agora √† camada Application.Animals, uma vez que a elegibilidade √© uma caracter√≠stica intr√≠nseca ao animal, e n√£o ao pedido.
O endpoint HTTP respons√°vel por esta verifica√ß√£o foi movido para o AnimalsController, refletindo a nova estrutura.
Esta abordagem assegura consist√™ncia entre o dom√≠nio, a API e as camadas de aplica√ß√£o, eliminando duplica√ß√£o de c√≥digo e melhorando a manutenibilidade.

**üîπ Principais altera√ß√µes**

1. Query CheckAnimalEligibilityForOwnership
Agora localizada em Application/Animals/Queries/CheckAnimalEligibilityForOwnership.cs.
Respons√°vel por validar:

- Se o animal existe.
- Se o seu estado √© compat√≠vel com ownership (Available).

Retorna Result<bool> com:

- 404 ‚Üí Animal n√£o encontrado.
- 400 ‚Üí Animal ineleg√≠vel (estado HasOwner, Inactive, PartiallyFostered ou TotallyFostered).
- 200 ‚Üí Animal eleg√≠vel (Available).

2. Integra√ß√£o no CreateOwnershipRequest

- O handler do comando continua a invocar a query CheckAnimalEligibilityForOwnership via Mediator, garantindo que a verifica√ß√£o √© sempre feita antes de criar o pedido.
- Elimina l√≥gica duplicada e mant√©m a coer√™ncia entre fluxos da API e da aplica√ß√£o.

3. Novo endpoint no AnimalsController

- GET /api/animals/check-eligibility/{id}
- Permite verificar, via API, se um animal est√° eleg√≠vel para ownership antes de criar o pedido.
- Retorna resposta estruturada com o estado da verifica√ß√£o.

4. Testes unit√°rios

- Foram atualizados e reorganizados os testes para refletir a nova estrutura:
- 404 ‚Üí Animal inexistente.
- 400 ‚Üí Animal ineleg√≠vel.
- 200 ‚Üí Animal eleg√≠vel (retorna true).
- Verificam tamb√©m chamadas ao Mediator e ao Mapper.

5. Seed da base de dados
DbInitializer atualizado com 5 animais em diferentes estados:

- ‚úÖ Available ‚Äî eleg√≠vel.
- ‚ùå HasOwner, Inactive, PartiallyFostered, TotallyFostered ‚Äî ineleg√≠veis.
- Permite testar todos os cen√°rios de elegibilidade automaticamente.

**üîπ Benef√≠cios**
‚úÖ L√≥gica de elegibilidade centralizada na entidade correta (Animals).
‚úÖ Elimina√ß√£o de duplica√ß√£o no CreateOwnershipRequest.
‚úÖ Arquitetura mais limpa e modular.
‚úÖ Testes unit√°rios com cobertura total dos cen√°rios.
‚úÖ API mais intuitiva e coerente com o dom√≠nio.
- Feature/Add image storage service - basic `n
## üß© Feature: Add Image Storage Service

### üîπ Descri√ß√£o geral

Foi implementado um **servi√ßo gen√©rico e reutiliz√°vel para gest√£o de imagens** em toda a aplica√ß√£o, permitindo associar fotos a diferentes entidades do dom√≠nio (`Animal`, `Shelter`, e futuramente `Activity`).
O objetivo principal √© **centralizar a l√≥gica de upload, armazenamento e associa√ß√£o** de imagens, garantindo consist√™ncia, reuso e f√°cil extensibilidade.

A implementa√ß√£o suporta:

* Upload de ficheiros atrav√©s do **Cloudinary** (via `IImageService` / `ImageService`);
* Associa√ß√£o autom√°tica da imagem √† entidade correta atrav√©s de **linkers espec√≠ficos**;
* Garantia de que apenas **uma imagem principal** est√° marcada por entidade;
* Invoca√ß√£o gen√©rica via **MediatR**, permitindo reutiliza√ß√£o do mesmo *command* e *handler* em qualquer agregado.

---

### üîπ Funcionamento

Ao criar um novo `Animal` (`POST /api/animals`), √© obrigat√≥ria a inclus√£o de uma imagem principal.
O **handler `CreateAnimal`**:

1. Cria o registo do animal na base de dados;
2. Invoca o comando gen√©rico `AddImage<Animal>` via `Mediator`, que:

   * Faz o upload da imagem para o Cloudinary (`SeePaw/Animal/{id}`);
   * Cria a entidade `Image` e associa-a ao `Animal`;
   * Garante que a imagem √© marcada como principal (`IsPrincipal = true`).

Posteriormente, o mesmo handler gen√©rico √© reutilizado no endpoint `POST /api/animals/{id}/images`, permitindo adicionar novas fotos ao mesmo animal (galeria) sem duplicar l√≥gica.

---

### üîπ Principais classes e ficheiros criados

üìÅ **Application/Images/**

* `AddImage<T>` ‚Äì *Command* e *Handler* gen√©ricos respons√°veis por gerir o upload e a associa√ß√£o de imagens.

üìÅ **Application/Images/Services/**

* `IImageOwnerLoader<T>` / `ImageOwnerLoader<T>` ‚Äì Carregam a entidade alvo (`Animal`, `Shelter`, etc.) a partir do `AppDbContext`.
* `IPrincipalImageEnforcer` / `PrincipalImageEnforcer` ‚Äì Garantem unicidade da imagem principal por entidade.
* `IImageOwnerLinker<T>` ‚Äì Interface gen√©rica que define como associar uma imagem a uma entidade.
* `AnimalImageLinker` ‚Äì Implementa√ß√£o espec√≠fica que define a associa√ß√£o de `Image` a `Animal`.
* `ShelterImageLinker` ‚Äì Implementa√ß√£o espec√≠fica que define a associa√ß√£o de `Image` a `Shelter`.

---

### üîπ Classes alteradas

üìÑ **Application/Animals/Commands/CreateAnimal.cs**

* Passou a invocar o comando gen√©rico `AddImage<Animal>` via `IMediator`, evitando replica√ß√£o de l√≥gica de upload.
* A imagem passou a ser **obrigat√≥ria** no processo de cria√ß√£o de um animal.

üìÑ **WebAPI/Controllers/AnimalsController.cs**

* Atualizado para receber dados via `multipart/form-data` (animal + imagem obrigat√≥ria).
* O endpoint `POST /api/animals` cria o animal e adiciona automaticamente a imagem principal atrav√©s do handler gen√©rico.
* Criado o endpoint `POST /api/animals/{id}/images` para permitir adicionar imagens adicionais.

---

### üîπ Benef√≠cios

* Reutiliza√ß√£o de c√≥digo e elimina√ß√£o de duplica√ß√µes.
* Extens√≠vel para novas entidades (`Activity`, `UserProfile`, etc.) sem altera√ß√µes estruturais.
* Maior coer√™ncia na gest√£o de imagens e simplifica√ß√£o do `CreateAnimal`.
* L√≥gica de upload totalmente isolada e test√°vel.

---

- feat: getActiveFosterings and CancelFostering (#69 #72) - basic`nThis PR closes user stories #69 and #72 .

**Summary**

This PR introduces the implementation of the GetActiveFosterings and CancelFostering features, enabling authenticated users to view and manage their active fostering relationships.

**Main Changes**
Added new endpoints to FosteringsController:

- GET /api/fosterings ‚Üí Retrieve all active fosterings for the authenticated user. This endpoint returns a list of the currently active fostering records associated with the authenticated user. Each fostering entry includes the fostered animal‚Äôs details (name, age, images), the monthly contribution amount and the start date of the fostering.

Example Response:

```
[
  {
    "animalName": "Tico",
    "animalAge": 5,
    "images": [
      {
        "id": "4af54a5c-73cf-48f9-a973-f4401bea984a",
        "isPrincipal": true,
        "url": "https://example.com/image.jpg",
        "description": "Tico no poleiro"
      }
    ],
    "amount": 10,
    "startDate": "2025-10-01T00:00:00"
  },
  {
    "animalName": "Rocky",
    "animalAge": 3,
    "images": [
{
        "id": "4af54a5c-73cf-48f9-a973-f4401bea984a",
        "isPrincipal": true,
        "url": "https://example.com/image.jpg",
        "description": "Rocky no poleiro"
      }
],
    "amount": 15,
    "startDate": "2025-09-15T00:00:00"
  }
]
```

- PATCH /api/fosterings/{id}/cancel ‚Üí Cancel an active fostering.
This endpoint allows an authenticated user to cancel one of their active fosterings by providing the fostering‚Äôs unique identifier (id). It validates that the fostering must belong to the authenticated user, updates the record‚Äôs status to Cancelled, and sets the EndDate to the current UTC time.

Example Response:

```
{
  "animalName": "Tico",
  "animalAge": 5,
  "amount": 10,
  "startDate": "2025-10-01T00:00:00",
  "endDate": "2025-10-26T12:00:00"
}
```

**DTOs and Validation**

- ResActiveFosteringDto ‚Äì Represents an active fostering record including animal details and images.
- ResCancelFosteringDto ‚Äì Represents a cancelled fostering, including the animal info, contribution amount, and start/end dates.


**Handlers**

- GetActiveFosterings.Query: Retrieves all fosterings where Status == Active and UserId == CurrentUserId, including related Animal and its Images.

- CancelFostering.Command: Validates ownership (UserId) and updates the fostering‚Äôs Status to Cancelled and sets EndDate = DateTime.UtcNow.

**Other Implementation:**

- Updated MappingProfiles.cs to include: CreateMap<Fostering, ResActiveFosteringDto>() and CreateMap<Fostering, ResCancelFosteringDto>();
- Documentation to all new classes.

**Unit Tests**

Added GetActiveFosteringsTests and CancelFosteringTests to validate success and failure cases for both query and command handlers, using isolated in-memory EF Core contexts

- Feature/update animal ownership approval`n## Overview

Implementa√ß√£o completa do m√≥dulo de **Ownership Requests** para gest√£o de pedidos de Ownership. 

### **Commands**

#### 1. **CreateOwnershipRequest** - Criar Pedido de Ownership
- Utilizadores autenticados podem submeter pedidos para adotar animais
- Valida√ß√µes autom√°ticas de disponibilidade do animal
- C√°lculo autom√°tico do montante baseado no custo do animal
- Preven√ß√£o de pedidos duplicados

#### 2. **UpdateOwnershipRequestStatus** - Mover para An√°lise
- Administradores CAA podem mover pedidos Pending/Rejected para Analysing
- Suporta workflow de reconsidera√ß√£o (Rejected ‚Üí Analysing)
- Valida√ß√£o de disponibilidade do animal
- Notas opcionais sobre o processo de an√°lise

#### 3. **ApproveOwnershipRequest** - Aprovar Pedido
- Aprova√ß√£o de pedidos em an√°lise
- Transfer√™ncia autom√°tica de ownership do animal
- Cancelamento autom√°tico de fosterings ativos
- Rejei√ß√£o autom√°tica de outros pedidos pendentes para o mesmo animal

#### 4. **RejectOwnershipRequest** - Rejeitar Pedido
- Rejei√ß√£o de pedidos em an√°lise
- Raz√£o de rejei√ß√£o opcional (vis√≠vel ao utilizador)
- Permite reconsidera√ß√£o posterior

### **Query**

#### 5. **GetOwnershipRequestsByShelter** - Listar Pedidos
- Listagem paginada de todos os pedidos do shelter do administrador
- Ordena√ß√£o por data de submiss√£o (mais recentes primeiro)
- Inclui informa√ß√µes do animal e utilizador


## üîó API Endpoints

### **Base URL:** `/api/ownershiprequests`

| M√©todo | Endpoint | Descri√ß√£o | Autentica√ß√£o |
|--------|----------|-----------|--------------|
| **POST** | `/` | Criar pedido de ownership | User autenticado |
| **PUT** | `/analysing/{id}` | Mover pedido para an√°lise | Admin CAA |
| **PUT** | `/approve/{id}` | Aprovar pedido | Admin CAA |
| **PUT** | `/reject/{id}` | Rejeitar pedido | Admin CAA |
| **GET** | `/` | Listar pedidos (paginado) | Admin CAA |



## Request & Response

### **1. Create Ownership Request**

**Request:**
```http
POST /api/ownershiprequests
Content-Type: application/json

{
  "animalID": "animal-123"
}
```

**Response (200):**
```json
{
  "id": "request-456",
  "animalId": "animal-123",
  "animalName": "Bolinhas",
  "userId": "user-789",
  "userName": "Jo√£o Silva",
  "amount": 150.00,
  "status": "Pending",
  "requestInfo": null,
  "requestedAt": "2025-01-01T10:00:00Z",
  "approvedAt": null,
  "updatedAt": "2025-01-01T10:00:00Z"
}
```

---

### **2. Move to Analysis**

**Request:**
```http
PUT /api/ownershiprequests/analysing/request-456
Content-Type: application/json

{
  "requestInfo": "Checking user references and home conditions"
}
```

**Response (200):**
```json
{
  "id": "request-456",
  "animalId": "animal-123",
  "animalName": "Bolinhas",
  "userId": "user-789",
  "userName": "Jo√£o Silva",
  "amount": 150.00,
  "status": "Analysing",
  "requestInfo": "Checking user references and home conditions",
  "requestedAt": "2025-01-01T10:00:00Z",
  "approvedAt": null,
  "updatedAt": "2025-01-02T14:30:00Z"
}
```

---

### **3. Approve Request**

**Request:**
```http
PUT /api/ownershiprequests/approve/request-456
```

**Response (200):**
```json
{
  "id": "request-456",
  "animalId": "animal-123",
  "animalName": "Bolinhas",
  "userId": "user-789",
  "userName": "Jo√£o Silva",
  "amount": 150.00,
  "status": "Approved",
  "requestInfo": "Checking user references and home conditions",
  "requestedAt": "2025-01-01T10:00:00Z",
  "approvedAt": "2025-01-05T16:45:00Z",
  "updatedAt": "2025-01-05T16:45:00Z"
}
```

**O que implica uma aprova√ß√£o:**
- Animal ownership √© do User
- Todos os fosterings para este animal s√£o cancelados
- Todos os pedidos pendentes/em an√°lise para este animal s√£o rejeitados

---

### **4. Reject Request**

**Request:**
```http
PUT /api/ownershiprequests/reject/request-456
Content-Type: application/json

{
  "rejectionReason": "User does not meet shelter requirements"
}
```

**Response (200):**
```json
{
  "id": "request-456",
  "animalId": "animal-123",
  "animalName": "Bolinhas",
  "userId": "user-789",
  "userName": "Jo√£o Silva",
  "amount": 150.00,
  "status": "Rejected",
  "requestInfo": "User does not meet shelter requirements",
  "requestedAt": "2025-01-01T10:00:00Z",
  "approvedAt": null,
  "updatedAt": "2025-01-03T11:20:00Z"
}
```

---

## Regras e Valida√ß√µes
### **Autoriza√ß√£o**
| A√ß√£o | Papel Necess√°rio | Valida√ß√£o |
|------|------------------|-----------|
| Criar Pedido | Utilizador Autenticado | ‚úÖ Qualquer utilizador autenticado |
| Gerir Pedidos | Admin CAA | ‚úÖ Tem de ser administrador do abrigo<br>‚ùå N√£o pode gerir pedidos de outros abrigos |
### **Poss√≠veis Fluxos de Trabalho**
```
Pendente ‚Üí Em An√°lise ‚Üí Aprovado
               ‚Üì
           Rejeitado ‚Üí Em An√°lise (reconsidera√ß√£o) ‚Üí Aprovado
```
Em qualquer dos 2 casos pode terminar em Rejeitado.
### **Valida√ß√µes de Cria√ß√£o de Pedido**
| Valida√ß√£o | C√≥digo de Erro | Mensagem |
|-----------|----------------|----------|
| Animal existe | 404 | "Animal ID not found" |
| Animal n√£o est√° Inativo | 400 | "Animal is not available for ownership" |
| Animal n√£o tem dono | 400 | "Animal is not available for ownership" |
| Sem pedido duplicado | 400 | "You already have a pending ownership request for this animal" |
### **Valida√ß√µes de Movimenta√ß√£o para An√°lise**
| Valida√ß√£o | C√≥digo de Erro | Mensagem |
|-----------|----------------|----------|
| Pedido existe | 404 | "Ownership request not found" |
| Estado √© Pendente/Rejeitado | 400 | "Only pending or rejected requests can be moved to analysis" |
| Animal n√£o est√° Inativo | 400 | "Cannot analyze request, animal is inactive" |
| Animal n√£o tem dono | 400 | "Cannot analyze request, animal already has an owner" |
| Utilizador √© admin do abrigo | 403 | "Only shelter administrators can update ownership requests" |
| Animal √© do mesmo abrigo | 403 | "You can only update requests for animals in your shelter" |
### **Valida√ß√µes de Aprova√ß√£o de Pedido**
| Valida√ß√£o | C√≥digo de Erro | Mensagem |
|-----------|----------------|----------|
| Pedido existe | 404 | "Ownership request not found" |
| Estado √© Em An√°lise | 400 | "Only requests in 'Analysing' status can be approved" |
| Animal n√£o est√° Inativo | 400 | "Cannot approve request, animal is inactive" |
| Animal n√£o tem dono | 400 | "Cannot approve request, animal already has an owner" |
| Sem outro pedido aprovado | 400 | "Cannot approve, animal already has an approved ownership request" |
| Utilizador √© admin do abrigo | 403 | "Only shelter administrators can approve ownership requests" |
| Animal √© do mesmo abrigo | 403 | "You can only approve requests for animals in your shelter" |
### **Valida√ß√µes de Rejei√ß√£o de Pedido**
| Valida√ß√£o | C√≥digo de Erro | Mensagem |
|-----------|----------------|----------|
| Pedido existe | 404 | "Ownership request not found" |
| Estado √© Em An√°lise | 400 | "Only requests in 'Analysing' status can be rejected" |
| Utilizador √© admin do abrigo | 403 | "Only shelter administrators can reject ownership requests" |
| Animal √© do mesmo abrigo | 403 | "You can only reject requests for animals in your shelter" |

---
## Outras mudan√ßas:
- Modifiquei a classe "dbinitializer" para que os users tenham IDs fixos para que os testes de integra√ß√£o funcionem sem conflitos
- Acrescentei um user que √© administrador do Shelter 2, para incluir mais um caso de teste de integra√ß√£o importante para os Ownership Requests
---

Segundo reviewer: @joelpinto-aw 

Fecha as issues #26 e #28 
- feat: get and edit users profile (#47 #49) - basic`nThis PR closes user stories #47 and #49 .

**Summary**

This PR introduces the implementation of the GetUserProfile and EditUserProfile functionalities, allowing both regular users and Admin CAA accounts to view and update their personal information.

**Main Changes**
Added new endpoints in UsersController:

- GET /api/users: Retrieve the currently authenticated user's profile (GetUserProfile)

This endpoint returns the profile details of the authenticated user, whether they are a regular user or an Admin CAA. If the user is not authenticated, the endpoint returns an error saying "User is not authenticated".

Response Example:

```
{
    "id": "38bd42ca-c819-4496-be10-0d312a08c837",
    "name": "Diana Silva",
    "birthDate": "1990-09-30",
    "street": "Rua das Oliveiras 10",
    "city": "Faro",
    "postalCode": "8000-333",
    "phoneNumber": "912345678",
}
```

- PUT /api/users: Edit the authenticated user's profile (EditUserProfile)

This endpoint allows updating editable personal details for the logged-in user.
It returns the new user object updated or an error in case any field does't follow the validation rules.
Request Example:

```
{
    "name": "Diana Ferreira",
    "birthDate": "1990-09-30",
    "street": "Avenida 25 de Abril, 101",
    "city": "Faro",
    "postalCode": "8000-333",
    "phoneNumber": "913456789"
}
```

**DTOs and Validation**

- ReqUserProfileDto ‚Üí Defines editable fields available for user profile updates.
- ResUserProfileDto ‚Üí Defines the structure of the user profile data returned.
- UserProfileValidator, enforcing domain constraints.

**Handlers and Core Changes**

- Added GetUserProfile.Handler: Retrieves the authenticated user‚Äôs data. Returns a Result<User> with full user information or a 404 error if not found.
- Added EditUserProfile.Handler:  Validates user existence ‚Üí Updates editable fields only ‚Üí  Persists changes via EF Core while preserving authentication data integrity.


**Unit Tests**

- GetUserProfileTest: Ensures only an existing user can see its own personal data.
- EditUserProfileTest: Ensures invalid inputs are rejected by the validator and a valid user profile can be edited.


**Other Implementations**
- Updated MappingProfiles to include mappings between: User ‚Üî ResUserProfileDto and ReqUserProfileDto ‚Üî User
- Documentation for all DTOs, validators, and handlers.
- Added authentication checks to prevent unauthorized access to both endpoints.
- feat: edit and deactivated animal - basic`nThis PR closes user stories #30 and #31.


**Summary**

This PR introduces the implementation for the EditAnimal and DeactivateAnimal functionalities, ensuring compliance with business rules that govern animal management in shelters.
Both endpoints follow domain restrictions and maintain the consistency and integrity of the stored data.

**Main Changes**

Added new endpoints to AnimalsController:

- PUT /api/animals/{id} ‚Üí Edit an existing animal (EditAnimal)

Allows updating selected attributes of an existing animal record, returning the updated animal or an error if the updates fails.
The following JSON payload represents the data required to update an animal:
```
{
        "id": "f055cc31-fdeb-4c65-bb73-4f558f67dd0c",
        "name": "Pipoca",
        "species": "Dog",
        "size": "Small",
        "sex": "Female",
        "breedId": "2b2b2222-2222-2222-2222-222222222222",
        "animalState": "PartiallyFostered",
        "colour": "Dourado",
        "birthDate": "2024-01-12",
        "age": 1,
        "description": "Cadela pequena e simp√°tica, ideal para crian√ßas.",
        "sterilized": false,
        "features": "Muito ativa e adora correr na roda",
        "cost": 10,
        "shelterId": "11111111-1111-1111-1111-111111111111",
         "images": [
            {
                "id": "11fe0ca9-5f41-498c-a82a-74fd46914ed3",
                "isPrincipal": true,
                "url": "https://example.com/image.jpg",
                "description": "Thor atento ao port√£o"
            }
        ]
    }
```
This endpoint returns the full updated animal object.

- PATCH /api/animals/{id}/deactivate ‚Üí Deactivate an animal (DeactivateAnimal)

This endpoint performs a logical deactivation of the animal record.

It receives only the animal ID in the request and returns the full updated animal object after changing its state to Inactive or an error if it fails.
Animals with states HasOwner, PartiallyFostered, or TotallyFostered cannot be deactivated.


**DTOs and Validation**

- Added a new ReqEditAnimalDto, which inherits from ReqCreateAnimalDto, allowing reuse of common fields and validation rules while introducing the additional editable property. 
- Created the EditAnimalValidator, which inherits from CreateAnimalValidator, automatically applying all creation validation rules.
- It also adds new specific rules for editing operations, such as validating the provided AnimalState. 

**Other Implementations**

- Added new EditAnimal and DeactivateAnimal command handlers in Application.Animals.Commands.
- Updated MappingProfiles to support conversion between ReqEditAnimalDto ‚Üî Animal and return ResAnimalDto in the response.
- Added documentation to all new classes.

**Unit Tests**

Comprehensive unit tests were implemented for both features 

- EditAnimalTests: Ensures invalid inputs are rejected by the validator and a valid animal can be edited.

- DeactivateAnimalTests: Ensures that animals that are owned or fostered cannot change their status to Inactive and also checks if a shelterId or an animalId doesn't exist it's also not possible to change the animal's status to Inactive.
 



- feat: added auth to CreateAnimal and GetAnimalsByShelter (#26 #36) - basic`nThis PR closes user stories #29 and #36. It fully meets all acceptance criteria, including the AdminCAA authorization feature in #29 and #36, which has now been implemented with JWT authentication and authorization.

**Key Changes:**

- JWT authentication and authorization fully integrated
- AdminCAA role-based authorization implemented for protected endpoints
- POST /api/animals (CreateAnimal) now requires AdminCAA authorization via Bearer token in headers
- GET /api/animals/shelter/{id} (GetAnimalsByShelter) now requires authentication via Bearer token in headers

- Feature(auth): Implementar a autentica√ß√£o do utilizador (#44) - basic`nImplementa√ß√£o do endpoint de login (RFAP-02).

- Criado endpoint POST /api/login
- Valida√ß√£o de credenciais (Identity)
- Gera√ß√£o de token JWT com role
- Testes unit√°rios inclu√≠dos
- Mensagens JSON uniformizadas via IdentityResponseMiddleware

Testes:
- Login com credenciais v√°lidas
- Mensagem clara para erro de credenciais
- Token JWT v√°lido para rotas protegidas

Closes #44 

- Feature: Endpoint para detalhe de animal (#53) - basic`n### üìù Descri√ß√£o
Este *pull request* implementa o endpoint respons√°vel por devolver a informa√ß√£o detalhada de um animal, conforme o requisito **RFCA-02 ‚Äì Detalhe do Animal**.

### üîß Altera√ß√µes principais
- Implementado o endpoint `GET /api/animals/{id}` no controlador de animais.  
- Adicionada valida√ß√£o do ID e controlo de acesso aos dados.  
- Filtrados animais com estados **‚ÄúN√£o Dispon√≠vel‚Äù**, **‚ÄúApadrinhamento Total‚Äù** e **‚ÄúOwnership‚Äù** (n√£o s√£o apresentados).  
- Tratamento de erros:
  - ID inv√°lido ou inexistente ‚Üí devolve `404 Not Found`;
  - Outros erros ‚Üí devolvem mensagens apropriadas via `BaseApiController.HandleResult`.
- Criados testes unit√°rios para validar os diferentes cen√°rios de sucesso e falha.

### ‚úÖ Crit√©rios de aceita√ß√£o cobertos
- O endpoint devolve corretamente o detalhe de um animal por ID.  
- O ID √© validado e os dados s√£o obtidos da base de dados.  
- Animais ocultos n√£o s√£o expostos.  
- Em caso de falha, √© devolvida uma mensagem de erro adequada.

- feat: add createAnimal, ListAnimals and ListAnimalsByShelter endpoints (#29 #51 #36) - basic`nThis PR closses user stories #29, #51, and #36,.  It meets the acceptance criteria with the exception of the AdminCAA authorization feature in #29 and #36, which will be completed once JWT authentication is integrated.

### Summary
This PR introduces the implementation for the **Animals** and **Shelters** modules, including endpoints, entity definitions, validation, and global error handling middleware.

### Main Changes

**Added new endpoints to AnimalsController:**
- `POST /api/animals` ‚Üí Create a new animal (CreateAnimal) and returns the animal id created (9a77dab7-d0cb-42c1-9a15-9a5d18607a73)
The following JSON payload represents the data required to create a new animal record in the system.

```
{
  "name": "Leo",
  "species": "Cat",
  "description": "A calm and friendly cat who loves attention.",
  "size": "Small",
  "sex": "Male",
  "colour": "Grey",
  "birthDate": "2018-05-10",
  "sterilized": false,
  "breedId": "4dd8e9a3-5490-4f60-8604-4a90c532c257",
  "cost": 30.6,
  "features": "Microchipped and vaccinated.",
  "images": [
    {
      "isPrincipal": true,
      "url": "https://example.com/images/celinho1.jpg",
      "description": "Celinho posing for the camera."
    },
    {
      "isPrincipal": false,
      "url": "https://example.com/images/celinho2.jpg",
      "description": "Celinho relaxing in the sun."
    }
  ]
}


```

- `GET /api/animals` ‚Üí Retrieve a paginated list of available and partially fostered animals (ListAnimals). 
This endpoint receives optionally a pageNumber parameter, returning the following ordered list of animals that are currently available or partially fostered.
```
[
    {
            "animalId": "9b4fac41-6bc5-464c-b6da-bbe3aeffd93c",
            "name": "Bolinhas",
            "species": "Cat",
            "size": "Small",
            "sex": "Male",
            "breed": {
                "id": "4dd8e9a3-5490-4f60-8604-4a90c532c257",
                "name": "Siam√™s",
                "description": "Ra√ßa de gato elegante e soci√°vel."
            },
            "animalState": "Available",
            "colour": "Branco e cinzento",
            "birthDate": "2022-04-15",
            "age": 3,
            "description": "Gato muito meigo e brincalh√£o, gosta de dormir ao sol.",
            "sterilized": true,
            "features": "Olhos verdes, muito soci√°vel",
            "cost": 30,
            "shelterId": "11111111-1111-1111-1111-111111111111",
            "images": [
                {
                    "imageId": "3d04f390-6c11-493e-9dd3-ef7c16b69a08",
                    "isPrincipal": false,
                    "url": "https://example.com/images/bolinhas2.jpg",
                    "description": "Bolinhas a brincar."
                },
                {
                    "imageId": "3e557884-179f-4045-9b3c-27a3f0f3f6c6",
                    "isPrincipal": true,
                    "url": "https://example.com/images/bolinhas1.jpg",
                    "description": "Bolinhas."
                }
            ]
        },
...
]
```

**Added new endpoints to SheltersController:**
- `GET /api/shelters/{shelterId}/animals` ‚Üí List all animals by shelter (ListAnimalsByShelter)
This endpoint receives a shelterId and optionally a pageNumber parameter, returning the following ordered list of animals associated with that shelter.

```
[
    {
        "animalId": "7409efd8-371d-4ddf-acc0-3c4384d621e0",
        "name": "Leo",
        "species": "Cat",
        "size": "Small",
        "sex": "Male",
        "breed": {
            "id": "4dd8e9a3-5490-4f60-8604-4a90c532c257",
            "name": "Siam√™s",
            "description": "Ra√ßa de gato elegante e soci√°vel."
        },
        "animalState": "Available",
        "colour": "Grey",
        "birthDate": "2018-05-10",
        "age": 7,
        "description": "A calm and friendly cat who loves attention.",
        "sterilized": false,
        "features": "Microchipped and vaccinated.",
        "cost": 30.6,
        "shelterId": "22222222-2222-2222-2222-222222222222",
        "images": [
            {
                "imageId": "420c5869-bb01-4c49-bafb-0df4f4a98796",
                "isPrincipal": false,
                "url": "https://example.com/images/celinho2.jpg",
                "description": "Celinho relaxing in the sun."
            },
            {
                "imageId": "ed999539-8efe-454a-9004-e39d954f1d5c",
                "isPrincipal": true,
                "url": "https://example.com/images/celinho1.jpg",
                "description": "Celinho posing for the camera."
            }
        ]
    },
...
]
```

### Other Implementations
- Implemented `ExceptionMiddleware` to handle unhandled exceptions globally and return structured JSON error responses using the `AppException` model.
- Added specific handling for `ValidationException` from FluentValidation.
- Integrated FluentValidation for automatic validation of DTOs (`BaseAnimalDTO`, `CreateAnimalDTO`).
- Updated `Program.cs` configuration accordingly.

### Documentation

Added documentation to:
- Validators (CreateAnimalValidator)
- Controllers (AnimalsControllers, SheltersControllers)
- Core ( MappingProfils, PagedList)
- DTOs (CreateAnimalDTO)
- Added inline comments for clarity and maintainability across the domain and persistence layers.

---

### Unit Tests
- Added comprehensive **unit test suites** for both controllers:
   - **CreateAnimalValidator** ‚Üí covering field-level validation for name, breed, enums, cost, images and date constraints using an isolated valid DTO baseline
  - **GetAnimalsTests** ‚Üí covering listing animals, filtering by state, pagination and ordering.
  - **GetAnimalsByShelterTests** ‚Üí covering listing animals by shelter, ordering, pagination and filtering by shelter ID.
- Moq was used to mock dependencies such as IMapper, allowing controller and handler tests to run without relying on the real AutoMapper configuration or external services.
- EF Core‚Äôs InMemory provider was used to simulate a database context (AppDbContext) for data-driven tests, eliminating the need for a real PostgreSQL instance.


- Revert " feat(animals): implement endpoint to get animal details by ID #53 - (basic)"`nReverts see-paw/backend#95
-  feat(animals): implement endpoint to get animal details by ID #53 - (basic)`nEsta PR implementa o endpoint GET /api/animals/{id}, que devolve o detalhe de um animal identificado por ID.

Altera√ß√µes principais:

Valida√ß√£o de GUID atrav√©s do GuidStringValidator
Reposit√≥rio atualizado para retornar apenas animais vis√≠veis
Mensagens de erro para estados ‚ÄúN√£o Dispon√≠vel‚Äù, ‚ÄúApadrinhamento Total‚Äù e ‚ÄúOwnership‚Äù
Testes unit√°rios e de integra√ß√£o adicionados

Crit√©rios de aceita√ß√£o:

GET devolve o detalhe do animal por ID
O ID √© validado
Animais ocultos n√£o s√£o expostos
Em caso de erro √© devolvida mensagem adequada

Relacionado:
Closes #53 
